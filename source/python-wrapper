
# jsfour: go though the dependencies below and remove anything we arent using.
import urllib
from urllib.request import urlopen
import json
import time
import hmac,hashlib

import requests

import pandas as pd
from datetime import datetime as dt
from requests.auth import HTTPBasicAuth
from IPython.display import display, HTML, clear_output


# Python 3: Jupyter Notebook

#Public API
class Sfox:
        
    def __init__(self, config={'endpoint': "api.sfox.com", 'version': "v1"}):
        self.endpoint = config['endpoint']
        self.apiVersion = config['version']

    def urlFor(self,resource):
        return "https://" + self.endpoint + "/" + self.apiVersion + "/" + resource

    def rawbook(self,market):
        ret = urlopen(self.urlFor("markets/orderbook/")+ market)
        return json.loads(ret.read())
   
    #split GetBestPrice from API reference page (https://www.sfox.com/developers/#price-data)
    def bestBuyPrice(self,quantity):
        ret = urlopen(self.urlFor("offer/buy?amount=")+ str(quantity))
        print("Buy")
        return json.loads(ret.read())

    def bestSellPrice(self,quantity):
        ret = urlopen(self.urlFor("offer/sell?amount=")+ str(quantity))
        print("Sell")
        return json.loads(ret.read())
        

#Private API
    
class PrivateSfox():

    def __init__(self, APIKey, config={'endpoint': "api.sfox.com", 'version': "v1"}):
        self.endpoint = config['endpoint']
        self.apiVersion = config['version']
        self.APIKey = APIKey

    def urlFor(self,resource):
        return "https://" + self.endpoint + "/" + self.apiVersion + "/" + resource
    
    def market_buy(self,quantity,pair):
        ret = requests.post(self.urlFor("orders/buy"), data={'quantity': str(quantity),'currency_pair':str(pair)}, 
                            auth=HTTPBasicAuth(self.APIKey,''))
        return json.loads(ret.text)
    
    def market_sell(self,quantity,pair):
        ret = requests.post(self.urlFor("orders/sell"), data={'quantity': str(quantity),'currency_pair':str(pair)}, 
                            auth=HTTPBasicAuth(self.APIKey,''))
        return json.loads(ret.text)
    
    def limit_buy(self,quantity,price,pair):
        ret = requests.post(self.urlFor("orders/buy"), data={'quantity': str(quantity), 'price': str(price),
                            'currency_pair':str(pair)}, auth=HTTPBasicAuth(self.APIKey,''))
        return json.loads(ret.text)
    
    def limit_sell(self,quantity,price,pair):
        ret = requests.post(self.urlFor("orders/sell"), data={'quantity': str(quantity), 'price': str(price),
                            'currency_pair':str(pair)}, auth=HTTPBasicAuth(self.APIKey,''))
